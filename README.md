# Onethinx_OTX_Meson_Test_Project
This example is used for evaluating the Meson / Ninja build system for the Onethinx OTX-18 or PSoC6
## Prerequisites:
  - VS Code Extension: Meson / mesonbuild
  - Windows:
    - Install Meson & Ninja with the MSI installer from: [meson-1.0.0-64.msi
](https://github.com/mesonbuild/meson/releases)
    - or follow the instructions to install with pip/python: https://mesonbuild.com/Getting-meson.html
  - MacOS:
    - sudo port install meson (using MacPorts)
    - sudo port install ninja (using MacPorts)

## Project Description:
![VScode_Creator_Structure](https://github.com/onethinx/Readme_assets/raw/d4b9c19a9f5b2be4e3fee4209b54af13d91a648f/VScode_Creator_Structure.png)

The project should configured with PSoC Creator. After setup, the project can be built (Shift-F6) to generate the libraries and source files for the configuration. PSoC Creator will save these files in the 'Generated_Source' folder. When building succeeds, PSoC Creator executes the postbuild command which launches the Creator_PostBuild tool (see below for the postbuild setup).

The Creator_PostBuild tool and it's [source code is available here](https://github.com/RolfNoot/Creator_PostBuild). This tool reads the PSoCCreatorExportIDE.xml which is generated by PSoC Creator (see below for the IDE export setting). The xml file contains all the header, source and library files for configuring the PSoC. All the references to these files are inserted into the meson.build file by the use of comment tags. 
For example, the comment tags to insert the source files looks like this:
```
# Creator_PostBuild_SourceFiles_Start - automatic insert of source files by Creator_PostBuild. Do not edit below this line
...
# Creator_PostBuild_SourceFiles_End - automatic insert of source files by Creator_PostBuild. Do not edit above this line
```
The available comment tags can be found in the [meson.build file in this example.](https://github.com/onethinx/OTX-Meson-Testing/blob/main/meson.build)

## PSoC Creator Project Setup:
1. <b>Post Build setup</b><br>
  The Creator_PostBuild tool should be executed during PSoC Creator's post-build. In PSoC Creator, go to 'Project >> Build Settings >> ARM GCC X.XX >> User Commands >> Post Build' and add:  `Creator_PostBuild -v2`. When using the Onethinx module use `Creator_PostBuild -v2 -targetOTX`. The '-targetOTX' option creates an adapted 'cyfitter_cfg_otx.c' and strips the linker options from the reference to the PSoC Creator linker file, to accomplish compatibility with the Onethinx module.<br><br>
1. <b>IDE Export setting</b><br>
  PSoC Creator generates the IDE project information (PSoCCreatorExportIDE.xml) automatically when enabled. 
    - For PSoC3, 4 and 5 activate 'Project >> Export to IDE >> Makefile' 
    - For PSoC6 select 'Project >> Build Settings >> Target IDEs >> Makefile >> Generate'.
  

